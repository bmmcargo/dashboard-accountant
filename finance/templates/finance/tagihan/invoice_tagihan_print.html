{% load static %} {% load humanize %} {% load terbilang_filter %}
<!DOCTYPE html>
<html lang="id">
  <head>
    <meta charset="UTF-8" />
    <title>{{ invoice.no_invoice }}_{{ invoice.customer }}_{{ invoice.tanggal|date:"d-m-Y" }}</title>
    <style>
      @page {
        size: A4;
        margin: 10mm;
      }
      body {
        font-family: Arial, sans-serif;
        font-size: 11px;
        color: #000;
      }
      .container {
        width: 100%;
        max-width: 100%;
        margin: 0 auto;
      }

      /* Header */
      .header-table {
        width: 100%;
        border-bottom: 2px solid #000;
        margin-bottom: 5px;
      }
      .header-table td {
        vertical-align: top;
        padding: 5px;
      }
      .logo {
        max-height: 60px;
      }
      .company-info {
        font-size: 14px;
        font-weight: bold;
      }
      .company-detail {
        font-size: 10px;
        font-weight: normal;
      }

      .invoice-title {
        text-align: center;
        font-size: 18px;
        font-weight: bold;
        color: #000;
        text-transform: uppercase;
        margin: 8px 0;
        text-decoration: underline;
      }

      /* Meta Info */
      .meta-table {
        width: 100%;
        margin-bottom: 8px;
        border-collapse: collapse;
        font-size: 11px;
      }
      .meta-table td {
        padding: 1px 5px;
      }

      /* Main Table */
      .main-table {
        width: 100%;
        border-collapse: collapse;
        margin-bottom: 0;
        font-size: 10px;
      }
      .main-table th {
        background-color: #5b9bd5;
        color: #fff;
        border: 1px solid #000;
        padding: 4px 2px;
        text-align: center;
        font-weight: bold;
      }
      .main-table td {
        border: 1px solid #000;
        padding: 3px 4px;
        vertical-align: middle;
      }
      .col-center {
        text-align: center;
      }
      .col-right {
        text-align: right;
      }
      .col-left {
        text-align: left;
      }

      /* Summary rows */
      .summary-row td {
        border: 1px solid #000;
        padding: 3px 4px;
      }
      .no-border {
        border: none !important;
      }
      .total-row td {
        font-weight: bold;
      }

      /* Terbilang */
      .terbilang-box {
        border: 1px solid #000;
        padding: 4px 8px;
        margin: 8px 0;
        font-size: 10px;
        text-align: center;
      }

      /* Bank Info */
      .bank-info {
        margin-top: 15px;
        font-size: 11px;
      }
      .bank-table {
        width: 55%;
        float: left;
      }
      .bank-table td {
        padding: 1px 0;
      }

      .signature-box {
        width: 40%;
        float: right;
        text-align: center;
      }
      .sign-space {
        height: 60px;
      }

      .clear {
        clear: both;
      }

      @media print {
        .d-print-none {
          display: none !important;
        }
        /* Force background colors to print for header only */
        * {
          -webkit-print-color-adjust: exact !important;
          print-color-adjust: exact !important;
        }
        .main-table th {
          background-color: #5b9bd5 !important;
          color: #fff !important;
        }
      }
    </style>
  </head>
  <body>
    <div class="d-print-none" style="position: fixed; top: 10px; right: 10px; z-index: 1000">
      <a href="{% url 'tagihan_edit' invoice.pk %}" style="text-decoration: none; background: #ffc107; color: #000; padding: 5px 10px; border-radius: 4px; font-family: sans-serif; font-weight: bold; font-size: 12px">Edit Invoice</a>
      <a href="{% url 'invoice_list' %}" style="text-decoration: none; background: #6c757d; color: #fff; padding: 5px 10px; border-radius: 4px; font-family: sans-serif; font-weight: bold; font-size: 12px; margin-left: 5px">Kembali</a>
      <a href="javascript:window.print()" style="text-decoration: none; background: #0d6efd; color: #fff; padding: 5px 10px; border-radius: 4px; font-family: sans-serif; font-weight: bold; font-size: 12px; margin-left: 5px">Cetak</a>
    </div>

    <div class="container">
      <!-- Header -->
      <table class="header-table">
        <tr>
          <td style="width: 70px; padding-right: 10px; vertical-align: middle">
            <img src="{% static 'finance/img/logo-bmm.png' %}" class="logo" style="max-height: 60px; width: auto" />
          </td>
          <td style="vertical-align: middle">
            <div class="company-info">BMM CARGO</div>
            <div class="company-detail">
              Jl. Danau Sentarum Pontianak<br />
              E-Mail: bmmcargo@yahoo.co.id, ajaroh@yahoo.co.id<br />
              Telp. 081256655558 / 085650006440
            </div>
          </td>
        </tr>
      </table>

      <!-- Title -->
      <div class="invoice-title">INVOICE</div>

      <!-- Meta Info -->
      <table class="meta-table">
        <tr>
          <td style="width: 100px">Tgl Invoice</td>
          <td style="width: 180px">: {{ invoice.tanggal|date:"d F Y" }}</td>
          <td style="width: 100px; text-align: right">Tgl Jatuh Tempo</td>
          <td style="text-align: right">: {{ invoice.jatuh_tempo|date:"d F Y"|default:"-" }}</td>
        </tr>
        <tr>
          <td>Nama Customer</td>
          <td style="font-weight: bold">: {{ invoice.customer }}</td>
          <td style="text-align: right">No Invoice</td>
          <td style="font-weight: bold; text-align: right">: {{ invoice.no_invoice }}</td>
        </tr>
      </table>

      <!-- Main Table -->
      <table class="main-table">
        <thead>
          <tr>
            <th style="width: 25px">No</th>
            <th style="width: 80px">No AWB</th>
            <th style="width: 60px">Asal</th>
            <th style="width: 60px">Tujuan</th>
            <th style="width: 35px">Koli</th>
            <th style="width: 50px">Kilo</th>
            <th style="width: 60px">Biaya Handling</th>
            <th style="width: 80px">Total</th>
          </tr>
        </thead>
        <tbody>
          {% for item in invoice.inbound_items.all %}
          <tr>
            <td class="col-center">{{ forloop.counter }}</td>
            <td class="col-center">{{ item.no_resi }}</td>
            <td class="col-center">JKT</td>
            <td class="col-center">{{ item.tujuan|default:"RASAU"|truncatechars:10 }}</td>
            <td class="col-center">{{ item.koli }}</td>
            <td class="col-center">{{ item.kilo|floatformat:0 }}</td>
            <td class="col-center">Rp {{ item.tarif_per_kg|default:"-" }}</td>
            <td class="col-center">Rp {{ item.total_biaya|floatformat:0|intcomma }}</td>
          </tr>
          {% endfor %}

          <!-- Summary Rows -->
          <tr class="summary-row">
            <td colspan="6" class="no-border"></td>
            <td class="col-center">By Kirim AWB</td>
            <td class="col-center">Rp {{ invoice.biaya_awb|floatformat:0|intcomma }}</td>
          </tr>
          <tr class="summary-row total-row">
            <td colspan="6" class="no-border"></td>
            <td class="col-center" style="border: 1px solid #000; font-weight: bold">TOTAL</td>
            <td class="col-center" style="border: 1px solid #000; font-weight: bold">Rp {{ grand_total|intcomma }}</td>
          </tr>
        </tbody>
      </table>

      <!-- Terbilang Box -->
      <table style="width: 100%; margin-top: 5px; border-collapse: collapse">
        <tr>
          <td style="width: 75%; border: 1px solid #000; padding: 4px 8px; font-size: 10px; text-align: center">{{ grand_total|terbilang }}</td>
          <td style="width: 15%; border: none"></td>
        </tr>
      </table>

      <!-- Footer Info -->
      <div class="bank-info">
        <div class="bank-table">
          <strong>Mohon dikirim ke Rekening:</strong>
          <table>
            <tr>
              <td style="width: 100px">Nomor Rekening</td>
              <td>: 6465539899</td>
            </tr>
            <tr>
              <td>Bank</td>
              <td>: BCA Cabang Pontianak</td>
            </tr>
            <tr>
              <td>Atas Nama</td>
              <td>: Borneo Mega Mandiri CV</td>
            </tr>
          </table>
        </div>

        <div class="signature-box">
          <div>Pontianak, {{ invoice.tanggal|date:"d F Y" }}</div>
          <div class="sign-space"></div>
          <div style="font-weight: bold; text-decoration: underline">Syakina Hafifah</div>
          <div>Accounting</div>
        </div>
        <div class="clear"></div>
      </div>
    </div>
  </body>
</html>
